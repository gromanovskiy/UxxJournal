<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Journal quick test</title>
</head>
<body>
  <h1>Add entry</h1>

  <textarea id="body" rows="5" cols="40"
            placeholder="Write anything…"></textarea><br>
  <button id="saveBtn">Save</button>
  <p id="status"></p>

  <!-- Supabase JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>

    const { createClient } = supabase;
    // 1️⃣  connect
    const supa = createClient(
      'https://rzqrqezrcucnwovimflt.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6cXJxZXpyY3VjbndvdmltZmx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMzkyMDMsImV4cCI6MjA2OTkxNTIwM30.44XFy60EI-nGeseWGU2207mLXOeBau7me778XxmgDrk'
    );

    // 2️⃣  quick sign-in (magic link email). For a personal tool,
    //     you can have Supabase remember you in localStorage.
    async function ensureLogin() {
      // If user is already logged in, return immediately
      const { data: { session } } = await supa.auth.getSession();
      if (session) return;

      const email = prompt('Enter email for magic-link login');
      if (!email) throw new Error('Need an email to sign in');
      const { error } = await supa.auth.signInWithOtp({ email });
      alert('Check your email and click the link, then come back here.');
    }

    // 3️⃣  insert row when user clicks Save
    async function saveEntry() {
      const text = document.getElementById('body').value.trim();
      if (!text) return;

      const { error } = await supa
        .from('journal_entries')
        .insert({ body_text: text, tags: ['quick-test'] });

      document.getElementById('status').textContent =
        error ? '❌ ' + error.message : '✅ saved!';
      if (!error) document.getElementById('body').value = '';
    }

    // wire up
    ensureLogin().then(() => {
      document.getElementById('saveBtn').onclick = saveEntry;
    });
  </script>
</body>
</html>
